/* Accordion (Sections With Show/Hide Functionality) - Author: SÃ©bastien Millart - Version: 1.0.x - Licence: https://github.com/smillart/WAI-ARIA-Patterns-And-Widgets/blob/master/LICENSE */
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var o,i=_getPrototypeOf(t);if(e){var n=_getPrototypeOf(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||window;for(var o=0;o<this.length;o++)t.call(e,this[o],o,this)});var ControllerManager=function(){function t(e,o){_classCallCheck(this,t),this.currentItem=e,this.items=o,this.keyCode=Object.freeze({RETURN:13,SPACE:32,END:35,HOME:36,UP:38,DOWN:40})}return _createClass(t,[{key:"setFocusToFirstItem",value:function(){this.items[0].domNode.focus()}},{key:"setFocusToLastItem",value:function(){this.items[this.items.length-1].domNode.focus()}},{key:"setFocusToPreviousItem",value:function(){var t;this.currentItem===this.items[0]?this.setFocusToLastItem():(t=this.items.indexOf(this.currentItem),this.items[t-1].domNode.focus())}},{key:"setFocusToNextItem",value:function(){var t;this.currentItem===this.items[this.items.length-1]?this.setFocusToFirstItem():(t=this.items.indexOf(this.currentItem),this.items[t+1].domNode.focus())}}]),t}(),AccordionController=function(t){_inherits(o,ControllerManager);var e=_createSuper(o);function o(t,i){var n;return _classCallCheck(this,o),(n=e.call(this,t,i.buttons)).trigger=n.currentItem.domNode,n.accordion=i,n.bindEvents(),n}return _createClass(o,[{key:"bindEvents",value:function(){this.trigger.addEventListener("click",this.handleClick.bind(this)),this.trigger.addEventListener("keydown",this.handleKeydown.bind(this))}},{key:"handleClick",value:function(t){this.togglePanel()}},{key:"handleKeydown",value:function(t){console.log("[keydown]");var e=!1;switch(t.keyCode){case this.keyCode.UP:this.setFocusToPreviousItem(),e=!0;break;case this.keyCode.DOWN:this.setFocusToNextItem(),e=!0;break;case this.keyCode.HOME:this.setFocusToFirstItem(),e=!0;break;case this.keyCode.END:this.setFocusToLastItem(),e=!0}e&&(t.stopPropagation(),t.preventDefault())}},{key:"togglePanel",value:function(){if(this.trigger.hasAttribute("aria-expanded")){var t="true"==this.trigger.getAttribute("aria-expanded"),e=!1;this.items.forEach((function(t,o){"true"===t.domNode.getAttribute("aria-expanded")&&(e=t.domNode)}),this),!this.accordion.allowMultiple&&e&&e!==this.trigger&&(e.setAttribute("aria-expanded","false"),document.getElementById(e.getAttribute("aria-controls")).setAttribute("hidden",""),this.accordion.allowToggle||e.removeAttribute("aria-disabled")),t?this.accordion.allowToggle&&t&&(this.trigger.setAttribute("aria-expanded","false"),document.getElementById(this.trigger.getAttribute("aria-controls")).setAttribute("hidden","")):(this.trigger.setAttribute("aria-expanded","true"),document.getElementById(this.trigger.getAttribute("aria-controls")).removeAttribute("hidden"),this.accordion.allowToggle||this.trigger.setAttribute("aria-disabled","true"))}else this.items.indexOf(this.currentItem)===this.accordion.getOpenDefault()?(this.trigger.setAttribute("aria-expanded","true"),this.accordion.allowToggle||this.trigger.setAttribute("aria-disabled","true")):(this.trigger.setAttribute("aria-expanded","false"),document.getElementById(this.trigger.getAttribute("aria-controls")).setAttribute("hidden",""))}}]),o}(),WidgetManager=function(){function t(e,o){_classCallCheck(this,t),this.domNode=e,this.nodeClass="aria-".concat(o)}return _createClass(t,[{key:"hasSetting",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this.domNode.hasAttribute("data-".concat(this.nodeClass,"-").concat(t));return o&&(this.domNode.removeAttribute("data-".concat(this.nodeClass,"-").concat(t)),e&&this.addClass(this.domNode,"".concat(this.nodeClass,"--").concat(t),!1)),o}},{key:"getSetting",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.domNode.hasAttribute("data-".concat(this.nodeClass,"-").concat(t))){var o=this.domNode.getAttribute("data-".concat(this.nodeClass,"-").concat(t));return this.domNode.removeAttribute("data-".concat(this.nodeClass,"-").concat(t)),e&&"none"!==o&&this.addClass(this.domNode,"".concat(this.nodeClass,"--").concat(t),!1),o}}},{key:"addClass",value:function(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("string"==typeof e){var i="data-".concat(e.replace(/__|--/g,"-"));t&&(t.classList.add(e),t.hasAttribute(i)&&o&&t.removeAttribute(i))}}}]),t}(),Button=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,t),this.textNode=e,this.targetID=o,this.domNode,this.init()}return _createClass(t,[{key:"init",value:function(){this.domNode=document.createElement("button"),this.domNode.setAttribute("type","button"),this.textNode&&this.domNode.appendChild(document.createTextNode(this.textNode)),this.targetID&&document.getElementById(this.targetID)&&(this.domNode.setAttribute("aria-controls",this.targetID),this.domNode.setAttribute("id","".concat(this.targetID,"-trigger")))}}]),t}(),Accordion=function(t){_inherits(o,WidgetManager);var e=_createSuper(o);function o(t,i){var n;_classCallCheck(this,o);var a="Accordion constructor argument domNode",s="H2-H6 [".concat("data-aria-accordion-heading","]"),r="DIV [".concat("data-aria-accordion-panel","]");if(!t instanceof Element)throw new TypeError("".concat(a,"is not a DOM Element."));if(0===t.childElementCount)throw new Error("".concat(a," has no element children."));for(var c=new RegExp("H2|H3|H4|H5|H6","gi"),l=t.firstElementChild;l;){if(l&&"LI"===l.tagName)for(var d=l.firstElementChild;d;){if(d&&(!d.tagName.match(c)||!d.hasAttribute("data-aria-accordion-heading"))&&("DIV"!==d.tagName||!d.hasAttribute("data-aria-accordion-panel")))throw new Error("".concat(a," has UL/OL descendant elements that do not match with ").concat(s," or ").concat(r," as required."));d=d.nextElementSibling}else if(l&&(!l.tagName.match(c)||!l.hasAttribute("data-aria-accordion-heading"))&&("DIV"!==l.tagName||!l.hasAttribute("data-aria-accordion-panel")))throw new Error("".concat(a," has direct descendant elements that do not match with ").concat(s," or ").concat(r," as required."));l=l.nextElementSibling}return(n=e.call(this,t,"accordion")).accordionHeadingClass="".concat(n.nodeClass,"__heading"),n.accordionPanelClass="".concat(n.nodeClass,"__panel"),n.accordionHeading="[".concat("data-aria-accordion-heading","]"),n.accordionPanel="[".concat("data-aria-accordion-panel","]"),n.buttons=[],n.headings,n.panels,n.customClass,n.openDefault,n.panelTransition,n.allowMultiple,n.allowToggle,n.idCounter=0,n.index=i,n.init(),n}return _createClass(o,[{key:"init",value:function(){this.idCounter+=1,this.domNode.hasAttribute("id")||this.domNode.setAttribute("id","acc-".concat(this.idCounter,"-").concat(this.index)),this.addClass(this.domNode,this.nodeClass),document.querySelectorAll("#".concat(this.domNode.id," > li")).length?(this.headings=document.querySelectorAll("#".concat(this.domNode.id," > li > ").concat(this.accordionHeading)),this.panels=document.querySelectorAll("#".concat(this.domNode.id," > li > ").concat(this.accordionPanel))):(this.headings=document.querySelectorAll("#".concat(this.domNode.id," > ").concat(this.accordionHeading)),this.panels=document.querySelectorAll("#".concat(this.domNode.id," > ").concat(this.accordionPanel))),this.customClass=this.getSetting("custom-class",!1),this.customClass&&this.addClass(this.domNode,"".concat(this.nodeClass,"--").concat(this.customClass)),this.openDefault=this.getSetting("open-default"),this.allowMultiple=this.hasSetting("allow-multiple"),this.allowToggle=this.allowMultiple?this.allowMultiple:this.hasSetting("allow-toggle"),this.panelTransition=this.hasSetting("panel-transition",!1),this.setupPanels(),this.setupHeadingButton()}},{key:"setupPanels",value:function(){this.panels.forEach((function(t,e){this.addClass(t,this.accordionPanelClass),t.setAttribute("id","".concat(this.domNode.id,"-panel-").concat(e+1)),this.panelTransition&&this.addClass(t,"".concat(this.accordionPanelClass,"--transition"),!1)}),this)}},{key:"setupHeadingButton",value:function(){this.headings.forEach((function(t,e){this.addClass(t,this.accordionHeadingClass);var o=new Button(t.textContent,t.nextElementSibling.id);this.buttons.push(o),t.innerHTML="",t.appendChild(o.domNode),(this.allowMultiple&&this.panels.length<7||!this.allowMultiple)&&o.domNode.hasAttribute("aria-controls")&&(document.getElementById(o.domNode.getAttribute("aria-controls")).setAttribute("role","region"),document.getElementById(o.domNode.getAttribute("aria-controls")).setAttribute("aria-labelledby",o.domNode.id)),new AccordionController(o,this).togglePanel()}),this)}},{key:"getOpenDefault",value:function(){return void 0!==this.openDefault&&"none"!==this.openDefault&&NaN!==parseInt(this.openDefault)?this.openDefault<=1?0:this.openDefault-1>=this.panels.length?this.panels.length-1:this.openDefault-1:!this.allowToggle&&"none"!==this.openDefault&&0}}]),o}();window.addEventListener("DOMContentLoaded",(function(t){document.querySelectorAll("[data-aria-accordion]").forEach((function(t,e){new Accordion(t,e)}))}));